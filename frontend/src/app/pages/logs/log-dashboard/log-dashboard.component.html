<div class="container py-4">
  <div class="row mb-4">
    <div class="col-md-8">
      <h1 class="h3">Panel de Actividad del Sistema</h1>
    </div>
    <div class="col-md-4 text-md-end">
      <a routerLink="/dashboard/logs/list" class="btn btn-primary">
        Ver Todos los Logs
      </a>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="loading" class="p-4 text-center bg-white rounded shadow">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2 text-secondary">Cargando estadísticas...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="p-4 text-center text-danger bg-white rounded shadow">
    {{ error }}
  </div>

  <!-- Dashboard content -->
  <div *ngIf="!loading && !error && stats" class="row g-4">
    <!-- Total logs counter -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">Resumen de Actividad</h5>
          <p class="display-4 text-primary">{{ stats.totalLogs }}</p>
          <p class="text-secondary">Total de registros en el sistema</p>
        </div>
      </div>
    </div>

    <!-- Recent activity by date -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">Actividad Reciente</h5>
          <div class="mt-3">
            <div *ngFor="let item of stats.byDate" class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-secondary">{{ item.date }}</span>
              <div class="d-flex align-items-center">
                <div class="progress me-2" style="width: 100px; height: 10px;">
                  <div class="progress-bar bg-primary" [style.width.%]="item.count * 100 / (stats.totalLogs || 1)"></div>
                </div>
                <span class="text-secondary">{{ item.count }} acciones</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions breakdown -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">Acciones Realizadas</h5>
          <div class="mt-3">
            <div *ngFor="let action of stats.byAction" class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <span [class]="getColorForAction(action.action)">
                  {{ action.action }}
                </span>
              </div>
              <div class="d-flex align-items-center">
                <div class="progress me-2" style="width: 100px; height: 10px;">
                  <div class="progress-bar bg-primary" [style.width.%]="action.count * 100 / (stats.totalLogs || 1)"></div>
                </div>
                <span class="text-secondary">{{ action.count }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Entity types breakdown -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title">Tipos de Entidades</h5>
          <div class="mt-3">
            <div *ngFor="let entity of stats.byEntityType" class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <span [class]="getColorForEntityType(entity.entityType)">
                  {{ entity.entityType }}
                </span>
              </div>
              <div class="d-flex align-items-center">
                <div class="progress me-2" style="width: 100px; height: 10px;">
                  <div class="progress-bar bg-primary" [style.width.%]="entity.count * 100 / (stats.totalLogs || 1)"></div>
                </div>
                <span class="text-secondary">{{ entity.count }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top users -->
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Usuarios más Activos</h5>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Usuario</th>
                  <th>Email</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of stats.byUser.slice(0, 5)">
                  <td>{{ user.name }}</td>
                  <td>{{ user.email }}</td>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="progress me-2" style="width: 100px; height: 10px;">
                        <div class="progress-bar bg-primary" [style.width.%]="user.count * 100 / (stats.totalLogs || 1)"></div>
                      </div>
                      <span class="text-secondary">{{ user.count }}</span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 