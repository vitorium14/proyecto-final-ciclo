<div class="container py-4">
  <div class="row mb-4">
    <div class="col-md-8">
      <h1 class="h3">Registros de Actividad</h1>
    </div>
    <div class="col-md-4 text-md-end">
      <a routerLink="/dashboard/logs" class="btn btn-primary">
        Volver al Dashboard
      </a>
    </div>
  </div>

  <div class="card">
    <!-- Filtros -->
    <div class="card-header bg-white">
      <div class="row g-3">
        <div class="col-md-4">
          <label for="userSelect" class="form-label">Usuario</label>
          <select
            id="userSelect"
            [(ngModel)]="filters.userId"
            class="form-select"
          >
            <option [ngValue]="null">Todos los usuarios</option>
            <option *ngFor="let user of users" [ngValue]="user.id">{{ user.name }} ({{ user.email }})</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="actionSelect" class="form-label">Acción</label>
          <select
            id="actionSelect"
            [(ngModel)]="filters.action"
            class="form-select"
          >
            <option *ngFor="let option of actionOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="entityTypeSelect" class="form-label">Entidad</label>
          <select
            id="entityTypeSelect"
            [(ngModel)]="filters.entityType"
            class="form-select"
          >
            <option *ngFor="let option of entityTypeOptions" [value]="option.value">{{ option.label }}</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="startDate" class="form-label">Fecha inicio</label>
          <input
            type="date"
            id="startDate"
            [(ngModel)]="filters.startDate"
            class="form-control"
          />
        </div>
        <div class="col-md-4">
          <label for="endDate" class="form-label">Fecha fin</label>
          <input
            type="date"
            id="endDate"
            [(ngModel)]="filters.endDate"
            class="form-control"
          />
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <button
            (click)="applyFilters()"
            class="btn btn-primary me-2"
          >
            Aplicar Filtros
          </button>
          <button
            (click)="resetFilters()"
            class="btn btn-secondary"
          >
            Limpiar
          </button>
        </div>
      </div>
    </div>

    <!-- Loading state -->
    <div *ngIf="loading" class="card-body text-center p-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2 text-secondary">Cargando logs...</p>
    </div>

    <!-- Error state -->
    <div *ngIf="error && !loading" class="card-body text-center text-danger">
      {{ error }}
    </div>

    <!-- Table -->
    <div *ngIf="!loading && !error" class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-hover mb-0">
          <thead>
            <tr>
              <th>Fecha/Hora</th>
              <th>Usuario</th>
              <th>Acción</th>
              <th>Entidad</th>
              <th>Detalles</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of logs">
              <td>{{ formatDate(log.createdAt) }}</td>
              <td>
                <div>{{ log.user.name || 'Sistema' }}</div>
                <small class="text-muted">{{ log.user.email || '' }}</small>
              </td>
              <td>
                <span [class]="getActionClass(log.action)">
                  {{ getActionLabel(log.action) }}
                </span>
              </td>
              <td>
                <div>
                  <span [class]="getEntityTypeClass(log.entityType)">
                    {{ getEntityTypeLabel(log.entityType) }}
                  </span>
                </div>
                <small class="text-muted">ID: {{ log.entityId }}</small>
              </td>
              <td>{{ log.details }}</td>
            </tr>
            <tr *ngIf="!loading && !error && logs.length === 0">
              <td colspan="5" class="text-center py-4">
                No se encontraron registros con los filtros seleccionados.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="card-footer bg-white">
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-muted">
          Mostrando 
          <span class="fw-bold">{{ (currentPage - 1) * itemsPerPage + 1 }}</span>
          a
          <span class="fw-bold">{{ currentPage * itemsPerPage > totalItems ? totalItems : currentPage * itemsPerPage }}</span>
          de
          <span class="fw-bold">{{ totalItems }}</span>
          resultados
        </div>
        <div>
          <button
            (click)="onPageChange(currentPage - 1)"
            [disabled]="currentPage === 1"
            class="btn btn-sm btn-outline-secondary me-2"
          >
            Anterior
          </button>
          <button
            (click)="onPageChange(currentPage + 1)"
            [disabled]="currentPage === totalPages"
            class="btn btn-sm btn-outline-secondary"
          >
            Siguiente
          </button>
        </div>
      </div>
    </div>
  </div>
</div> 