<div class="animate-fade-in">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4">
    <div>
      <h1 class="h2 fw-bold mb-0">{{ isEditMode ? 'Editar' : 'Nuevo' }} Tipo de Habitación</h1>
      <p class="text-muted">{{ isEditMode ? 'Modifica los datos del tipo de habitación' : 'Añade un nuevo tipo de habitación al hostal' }}</p>
    </div>
    <div>
      <a [routerLink]="['/dashboard/room-types']" class="btn btn-outline-secondary rounded-pill px-4">
        <i class="bi bi-arrow-left me-2"></i> Volver
      </a>
    </div>
  </div>

  <!-- Alert for errors -->
  <div *ngIf="error" class="alert alert-danger mb-4">
    <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ error }}
  </div>

  <!-- Room Type Form -->
  <div class="card border-0 shadow-sm">
    <div class="card-body p-4">
      <form [formGroup]="roomTypeForm" (ngSubmit)="onSubmit()">
        <div class="row mb-4">
          <div class="col-md-6">
            <label for="name" class="form-label">Nombre <span class="text-danger">*</span></label>
            <input 
              type="text" 
              class="form-control" 
              id="name" 
              formControlName="name"
              [ngClass]="{'is-invalid': roomTypeForm.get('name')?.invalid && roomTypeForm.get('name')?.touched}"
              placeholder="Ej: Suite Premium, Habitación Doble...">
            <div class="invalid-feedback" *ngIf="roomTypeForm.get('name')?.errors?.['required'] && roomTypeForm.get('name')?.touched">
              El nombre es obligatorio
            </div>
            <div class="invalid-feedback" *ngIf="roomTypeForm.get('name')?.errors?.['maxlength'] && roomTypeForm.get('name')?.touched">
              El nombre no puede exceder los 100 caracteres
            </div>
          </div>

          <div class="col-md-6">
            <label for="price" class="form-label">Precio por noche (€) <span class="text-danger">*</span></label>
            <input 
              type="number" 
              class="form-control" 
              id="price" 
              formControlName="price"
              [ngClass]="{'is-invalid': roomTypeForm.get('price')?.invalid && roomTypeForm.get('price')?.touched}"
              min="0" 
              step="0.01"
              placeholder="Precio por noche">
            <div class="invalid-feedback" *ngIf="roomTypeForm.get('price')?.errors?.['required'] && roomTypeForm.get('price')?.touched">
              El precio es obligatorio
            </div>
            <div class="invalid-feedback" *ngIf="roomTypeForm.get('price')?.errors?.['min'] && roomTypeForm.get('price')?.touched">
              El precio no puede ser negativo
            </div>
          </div>
        </div>

        <div class="row mb-4">
          <div class="col-12">
            <label for="amenities" class="form-label">Características</label>
            <textarea 
              class="form-control" 
              id="amenities" 
              rows="3" 
              formControlName="amenities"
              placeholder="Aire acondicionado, TV, Minibar, Wi-Fi..."></textarea>
            <div class="form-text">Introduzca las características separadas por comas.</div>
          </div>
        </div>

        <!-- Images Section -->
        <div class="mb-4">
          <label class="form-label mb-3">Imágenes</label>
          <div class="card bg-light border-0">
            <div class="card-body">
              <div formArrayName="images">
                <div *ngFor="let imageGroup of imagesArray.controls; let i = index" [formGroupName]="i" class="mb-3 pb-3" [class.border-bottom]="i < imagesArray.length - 1">
                  <div class="row align-items-center">
                    <div class="col-md-8">
                      <div class="mb-3">
                        <label class="form-label">Imagen {{ i + 1 }}</label>
                        <input 
                          type="file" 
                          class="form-control" 
                          accept="image/*"
                          (change)="onFileSelected($event, i)"
                          [ngClass]="{'is-invalid': imageGroup.get('image')?.invalid && imageGroup.get('image')?.touched}">
                        <div class="invalid-feedback" *ngIf="imageGroup.get('image')?.errors?.['required'] && imageGroup.get('image')?.touched">
                          La imagen es obligatoria
                        </div>
                        <input type="hidden" formControlName="image">
                      </div>
                    </div>
                    <div class="col-auto ms-auto">
                      <button type="button" class="btn btn-outline-danger" (click)="removeImage(i)">
                        <i class="bi bi-trash me-1"></i> Eliminar
                      </button>
                    </div>
                  </div>
                  <div *ngIf="imageGroup.get('image')?.value" class="mt-3">
                    <img [src]="imageGroup.get('image')?.value" alt="Vista previa" class="img-thumbnail" style="max-height: 150px;">
                  </div>
                </div>
                
                <div *ngIf="imagesArray.length === 0" class="text-center py-4">
                  <i class="bi bi-card-image text-muted fs-1"></i>
                  <p class="text-muted mt-2">No hay imágenes añadidas</p>
                </div>
              </div>
              
              <div class="mt-3">
                <button type="button" class="btn btn-outline-primary" (click)="addImage()">
                  <i class="bi bi-plus-circle me-2"></i> Añadir Imagen
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-end mt-4">
          <button type="button" [routerLink]="['/dashboard/room-types']" class="btn btn-light me-2" [disabled]="isSubmitting">Cancelar</button>
          <button 
            type="submit" 
            class="btn btn-primary px-4" 
            [disabled]="isSubmitting || roomTypeForm.invalid">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            {{ isEditMode ? 'Guardar Cambios' : 'Crear Tipo de Habitación' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div> 