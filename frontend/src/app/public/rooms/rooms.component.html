<!-- Rooms Section -->
<section class="rooms-overview py-6 bg-light">
  <div class="container">
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center">
        <h1 class="display-4 fw-bold mb-3">Nuestras Habitaciones</h1>
        <p class="lead text-muted">Descubre los diferentes tipos de habitaciones que ofrecemos, diseñadas para
          tu confort.</p>
      </div>
    </div>
    <!-- Room Type Display (Example - Adapt as needed) -->
    <div *ngIf="isLoading && rooms.length === 0" class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Cargando tipos de habitación...</p>
    </div>

    <div *ngIf="!isLoading && rooms.length > 0" class="row g-4">
      <!-- Example: Display unique room types. You might want to group rooms by type -->
      <div *ngFor="let roomType of uniqueRoomTypes; let i = index" class="col-lg-4 col-md-6">
        <!-- Find first room of this type for display purposes -->
        <!-- Use helper method to get room example -->
        <ng-container *ngIf="getRoomExample(roomType) as roomExample">
          <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden hover-lift">
            <img [src]="roomExample.image || 'https://via.placeholder.com/400x250?text=Habitacion'"
              [alt]="roomExample.type" class="card-img-top object-fit-cover" height="250">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title fw-bold">{{ roomExample.type }}</h5>
              <!-- Removed description as it's not in the Room model -->
              <div class="d-flex justify-content-between align-items-center mt-3 pt-2"> <!-- Added pt-2 for spacing -->
                <span class="fw-bold text-primary fs-5">Desde {{ roomExample.price }}€/noche</span>
                <!-- Optional: Link to details or scroll to form -->
                <a href="#reservation-form" class="btn btn-sm btn-outline-primary rounded-pill px-3">Reservar</a>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <div *ngIf="!isLoading && rooms.length === 0 && !errorMessage" class="text-center text-muted mt-5">
      No hay tipos de habitación disponibles en este momento.
    </div>
    <div *ngIf="errorMessage && rooms.length === 0" class="alert alert-danger mt-4">
      {{ errorMessage }}
    </div>
  </div>
</section>

<!-- Reservation Form Section -->
<section id="reservation-form" class="reservation-form py-6 bg-white">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow border-0 rounded-4 p-4 p-lg-5">
          <h2 class="text-center fw-bold mb-4">Realiza tu Reserva</h2>
          <p class="text-center text-muted mb-4">Completa el formulario para reservar tu estancia. Si no tienes cuenta,
            se creará una automáticamente.</p>
          <form [formGroup]="reservationForm" (ngSubmit)="onSubmit()">
            <!-- Dates & Room Type -->
            <div class="row g-3 mb-3">
              <div class="col-md-4">
                <label for="checkIn" class="form-label">Entrada</label>
                <input type="date" id="checkIn" class="form-control" formControlName="checkIn"
                  [ngClass]="{'is-invalid': reservationForm.get('checkIn')?.invalid && reservationForm.get('checkIn')?.touched}">
                <div
                  *ngIf="reservationForm.get('checkIn')?.hasError('required') && reservationForm.get('checkIn')?.touched"
                  class="invalid-feedback">
                  Fecha de entrada requerida.
                </div>
                <div
                  *ngIf="reservationForm.hasError('checkInPast') && (reservationForm.get('checkIn')?.touched || reservationForm.get('checkOut')?.touched)"
                  class="invalid-feedback d-block">
                  La fecha de entrada no puede ser pasada.
                </div>
              </div>
              <div class="col-md-4">
                <label for="checkOut" class="form-label">Salida</label>
                <input type="date" id="checkOut" class="form-control" formControlName="checkOut"
                  [ngClass]="{'is-invalid': reservationForm.get('checkOut')?.invalid && reservationForm.get('checkOut')?.touched}">
                <div
                  *ngIf="reservationForm.get('checkOut')?.hasError('required') && reservationForm.get('checkOut')?.touched"
                  class="invalid-feedback">
                  Fecha de salida requerida.
                </div>
                <div
                  *ngIf="reservationForm.hasError('dateRangeInvalid') && (reservationForm.get('checkIn')?.touched || reservationForm.get('checkOut')?.touched)"
                  class="invalid-feedback d-block">
                  La fecha de salida debe ser posterior a la entrada.
                </div>
              </div>
              <div class="col-md-4">
                <label for="roomType" class="form-label">Tipo de Habitación</label>
                <select id="roomType" class="form-select" formControlName="roomType"
                  [ngClass]="{'is-invalid': reservationForm.get('roomType')?.invalid && reservationForm.get('roomType')?.touched}">
                  <option value="" disabled>Selecciona un tipo...</option>
                  <option *ngFor="let type of uniqueRoomTypes" [value]="type">{{ type }}</option>
                </select>
                <div
                  *ngIf="reservationForm.get('roomType')?.hasError('required') && reservationForm.get('roomType')?.touched"
                  class="invalid-feedback">
                  Selecciona un tipo de habitación.
                </div>
              </div>
            </div>

            <!-- Personal Info -->
            <div class="mb-3">
              <label for="fullName" class="form-label">Nombre Completo</label>
              <input type="text" id="fullName" class="form-control" formControlName="fullName"
                [ngClass]="{'is-invalid': reservationForm.get('fullName')?.invalid && reservationForm.get('fullName')?.touched}">
              <div
                *ngIf="reservationForm.get('fullName')?.hasError('required') && reservationForm.get('fullName')?.touched"
                class="invalid-feedback">
                Nombre completo requerido.
              </div>
              <div
                *ngIf="reservationForm.get('fullName')?.hasError('minlength') && reservationForm.get('fullName')?.touched"
                class="invalid-feedback">
                El nombre debe tener al menos 3 caracteres.
              </div>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Correo Electrónico</label>
              <input type="email" id="email" class="form-control" formControlName="email"
                [ngClass]="{'is-invalid': reservationForm.get('email')?.invalid && reservationForm.get('email')?.touched}">
              <div *ngIf="reservationForm.get('email')?.hasError('required') && reservationForm.get('email')?.touched"
                class="invalid-feedback">
                Correo electrónico requerido.
              </div>
              <div *ngIf="reservationForm.get('email')?.hasError('email') && reservationForm.get('email')?.touched"
                class="invalid-feedback">
                Formato de correo inválido.
              </div>
            </div>

            <!-- Password Info -->
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="password" class="form-label">Contraseña</label>
                <input type="password" id="password" class="form-control" formControlName="password"
                  [ngClass]="{'is-invalid': reservationForm.get('password')?.invalid && reservationForm.get('password')?.touched}">
                <div
                  *ngIf="reservationForm.get('password')?.hasError('required') && reservationForm.get('password')?.touched"
                  class="invalid-feedback">
                  Contraseña requerida.
                </div>
                <div
                  *ngIf="reservationForm.get('password')?.hasError('minlength') && reservationForm.get('password')?.touched"
                  class="invalid-feedback">
                  La contraseña debe tener al menos 6 caracteres.
                </div>
              </div>
              <div class="col-md-6">
                <label for="confirmPassword" class="form-label">Confirmar Contraseña</label>
                <input type="password" id="confirmPassword" class="form-control" formControlName="confirmPassword"
                  [ngClass]="{'is-invalid': (reservationForm.get('confirmPassword')?.invalid || reservationForm.hasError('passwordMismatch')) && reservationForm.get('confirmPassword')?.touched}">
                <div
                  *ngIf="reservationForm.get('confirmPassword')?.hasError('required') && reservationForm.get('confirmPassword')?.touched"
                  class="invalid-feedback">
                  Confirmación de contraseña requerida.
                </div>
                <div
                  *ngIf="reservationForm.hasError('passwordMismatch') && reservationForm.get('confirmPassword')?.touched"
                  class="invalid-feedback">
                  Las contraseñas no coinciden.
                </div>
              </div>
            </div>

            <!-- Messages -->
            <div *ngIf="successMessage" class="alert alert-success">
              {{ successMessage }}
            </div>
            <div *ngIf="errorMessage" class="alert alert-danger">
              {{ errorMessage }}
            </div>

            <!-- Submit Button -->
            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg" [disabled]="isLoading">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"
                  aria-hidden="true"></span>
                <span *ngIf="isLoading">Procesando...</span>
                <span *ngIf="!isLoading">Reservar Ahora</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>